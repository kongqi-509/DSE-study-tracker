<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“˜ æ™ºèƒ½å­¸ç¿’è¨ˆåŠƒï¼ˆPredicted Grade æ±ºå®šæº«ç¿’æ™‚é–“ï¼‰</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
  font-family:"Noto Sans TC",sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:20px;
  color:#222;
}
h1{text-align:center;color:#007bff;}
.card{
  background:#fff;
  margin:20px auto;
  padding:20px;
  border-radius:8px;
  box-shadow:0 3px 8px rgba(0,0,0,0.1);
  max-width:700px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  padding:8px;
  text-align:center;
  border-bottom:1px solid #eee;
}
th{background:#f0f3f6;}
button{
  background:#007bff;color:#fff;border:none;border-radius:6px;
  padding:10px 15px;font-size:1em;margin-top:10px;
}
button:hover{background:#0056b3;cursor:pointer;}
select{padding:6px;border-radius:6px;border:1px solid #ccc;}
canvas{max-width:100%;margin-top:20px;}
#msg{margin-top:15px;padding:10px;border-radius:6px;text-align:center;font-weight:bold;}
.success{background:#e8ffea;color:#1a7f37;border:1px solid #1a7f37;}
.error{background:#ffecec;color:#b71c1c;border:1px solid #b71c1c;}
small{color:#666;}
#backBtn{
  display:block;
  width:100%;
  text-align:center;
  background:#6c757d;
}
#backBtn:hover{background:#495057;}
</style>
</head>
<body>

<h1>ğŸ§  æ™ºèƒ½å­¸ç¿’è¨ˆåŠƒï¼ˆPredictedâ€¯Gradeâ€¯â†’â€¯æº«ç¿’æ™‚é–“æ¯”é‡ï¼‰</h1>

<div class="card">
  <h2>ğŸ“˜â€¯è¼¸å…¥å„ç§‘â€¯Predictedâ€¯Grade</h2>
  <table id="gradeTable">
    <thead><tr><th>ç§‘ç›®</th><th>é æ¸¬ç­‰ç´š</th></tr></thead>
    <tbody></tbody>
  </table>

  <button id="calcBtn">ğŸ“Šâ€¯è¨ˆç®—å»ºè­°æº«ç¿’æ¯”é‡</button>
  <canvas id="pieChart"></canvas>
</div>

<div class="card">
  <h2>ğŸ¯â€¯ä»Šæ—¥ä¸»/å‰¯ç§‘è¨­å®š</h2>
  <p>ğŸ“…â€¯æ—¥æœŸï¼š<span id="todayDate"></span></p>

  <label>ä¸»ç§‘ï¼š</label>
  <select id="main"></select>
  <label>å‰¯ç§‘ï¼š</label>
  <select id="sub"></select>
  <button id="saveBtn">ğŸ’¾â€¯å„²å­˜ä»Šæ—¥å»ºè­°</button>

  <div id="msg"></div>
  <button id="backBtn">â¬…ï¸â€¯è¿”å›æ¯æ—¥æ‰“å¡é </button>
  <small>å®Œæˆå¾Œå¯è‡³â€¯<a href="index.html" target="_blank">index.html</a>â€¯æŸ¥çœ‹åŒæ­¥çµæœã€‚</small>
</div>

<script>
// === è¨­å®šè³‡æ–™ ===
const subjects = ["ä¸­æ–‡","è‹±æ–‡","æ•¸å­¸","å…¬æ°‘èˆ‡ç¤¾æœƒç™¼å±•","ç”Ÿç‰©","åŒ–å­¸","ç‰©ç†","ç¶“æ¿Ÿ","æœƒè¨ˆ","ICT"];
const gradeValue = { "5**":7,"5*":6,"5":5,"4":4,"3":3,"2":2,"1":1 };
const todayStr = new Date().toLocaleDateString("zh-HK");

// === åˆå§‹åŒ–è¡¨æ ¼ ===
const tbody = document.querySelector("#gradeTable tbody");
subjects.forEach(s=>{
  const row=document.createElement("tr");
  row.innerHTML=`
    <td>${s}</td>
    <td>
      <select id="g_${s}">
        <option value="">--é¸æ“‡ç­‰ç´š--</option>
        ${Object.keys(gradeValue).map(g=>`<option>${g}</option>`).join("")}
      </select>
    </td>`;
  tbody.appendChild(row);
});

// === ä¸»/å‰¯ç§‘ä¸‹æ‹‰ ===
const mainSel=document.getElementById("main");
const subSel=document.getElementById("sub");
subjects.forEach(s=>{
  const o1=document.createElement("option");o1.textContent=s;mainSel.appendChild(o1);
  const o2=document.createElement("option");o2.textContent=s;subSel.appendChild(o2);
});
document.getElementById("todayDate").textContent=todayStr;

// === æ ¹æ“š Predicted Grade è¨ˆç®—åæ¯”æº«ç¿’æ¯”é‡ ===
function calcWeights(){
  let scores={};
  subjects.forEach(s=>{
    const g=document.getElementById("g_"+s).value;
    const val=gradeValue[g]||0;
    scores[s]=val? (8-val) : 0; // æˆç¸¾è¶Šä½â†’æ¯”é‡è¶Šé«˜
  });
  return scores;
}

// === ç¹ªåœ– ===
let chart;
function drawChart(weights){
  const data=Object.values(weights);
  const labels=Object.keys(weights);
  const ctx=document.getElementById("pieChart").getContext("2d");
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:"pie",
    data:{
      labels:labels,
      datasets:[{
        data:data,
        backgroundColor:[
          "#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF",
          "#FF9F40","#8BC34A","#E91E63","#9C27B0","#00BCD4"
        ]
      }]
    },
    options:{
      plugins:{
        legend:{position:"right"},
        title:{display:true,text:"å»ºè­°æº«ç¿’æ™‚é–“åˆ†é…ï¼ˆæˆç¸¾ä½â†’å¤šæ™‚é–“ï¼‰"}
      }
    }
  });
}

// === æŒ‰éˆ•äº‹ä»¶ ===
document.getElementById("calcBtn").addEventListener("click",()=>{
  const weights=calcWeights();
  drawChart(weights);
  alert("ğŸ“Šâ€¯å·²è¨ˆç®—å»ºè­°æº«ç¿’æ™‚é–“æ¯”é‡ï¼");
});

document.getElementById("saveBtn").addEventListener("click",()=>{
  const main=mainSel.value;
  const sub=subSel.value;
  const msgDiv=document.getElementById("msg");
  if(!main||!sub){
    msgDiv.className="error";
    msgDiv.textContent="âš ï¸â€¯è«‹å…ˆé¸ä¸»ç§‘èˆ‡å‰¯ç§‘ï¼";
    return;
  }
  const weights=calcWeights();
  localStorage.setItem("todaySuggestion",JSON.stringify({
    date:todayStr, main, sub, weights
  }));
  msgDiv.className="success";
  msgDiv.innerHTML=`âœ…â€¯å·²å„²å­˜ä»Šæ—¥å»ºè­°ï¼<br>ä¸»ç§‘ï¼š<b>${main}</b>â€¯|â€¯å‰¯ç§‘ï¼š<b>${sub}</b>`;
});

// === è¿”å›æŒ‰éˆ• ===
document.getElementById("backBtn").addEventListener("click",()=>{
  window.location.href="index.html";
});
</script>
</body>
</html>
